#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include "console_graphics2.h"

unsigned char ascii_chars[96][13] = {
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18},
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x36, 0x36, 0x36, 0x36},
{0x00, 0x00, 0x00, 0x66, 0x66, 0xff, 0x66, 0x66, 0xff, 0x66, 0x66, 0x00, 0x00},
{0x00, 0x00, 0x18, 0x7e, 0xff, 0x1b, 0x1f, 0x7e, 0xf8, 0xd8, 0xff, 0x7e, 0x18},
{0x00, 0x00, 0x0e, 0x1b, 0xdb, 0x6e, 0x30, 0x18, 0x0c, 0x76, 0xdb, 0xd8, 0x70},
{0x00, 0x00, 0x7f, 0xc6, 0xcf, 0xd8, 0x70, 0x70, 0xd8, 0xcc, 0xcc, 0x6c, 0x38},
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1c, 0x0c, 0x0e},
{0x00, 0x00, 0x0c, 0x18, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x18, 0x0c},
{0x00, 0x00, 0x30, 0x18, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x18, 0x30},
{0x00, 0x00, 0x00, 0x00, 0x99, 0x5a, 0x3c, 0xff, 0x3c, 0x5a, 0x99, 0x00, 0x00},
{0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0xff, 0xff, 0x18, 0x18, 0x18, 0x00, 0x00},
{0x00, 0x00, 0x30, 0x18, 0x1c, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x00, 0x38, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x60, 0x60, 0x30, 0x30, 0x18, 0x18, 0x0c, 0x0c, 0x06, 0x06, 0x03, 0x03},
{0x00, 0x00, 0x3c, 0x66, 0xc3, 0xe3, 0xf3, 0xdb, 0xcf, 0xc7, 0xc3, 0x66, 0x3c},
{0x00, 0x00, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78, 0x38, 0x18},
{0x00, 0x00, 0xff, 0xc0, 0xc0, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x03, 0xe7, 0x7e},
{0x00, 0x00, 0x7e, 0xe7, 0x03, 0x03, 0x07, 0x7e, 0x07, 0x03, 0x03, 0xe7, 0x7e},
{0x00, 0x00, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0xff, 0xcc, 0x6c, 0x3c, 0x1c, 0x0c},
{0x00, 0x00, 0x7e, 0xe7, 0x03, 0x03, 0x07, 0xfe, 0xc0, 0xc0, 0xc0, 0xc0, 0xff},
{0x00, 0x00, 0x7e, 0xe7, 0xc3, 0xc3, 0xc7, 0xfe, 0xc0, 0xc0, 0xc0, 0xe7, 0x7e},
{0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x18, 0x0c, 0x06, 0x03, 0x03, 0x03, 0xff},
{0x00, 0x00, 0x7e, 0xe7, 0xc3, 0xc3, 0xe7, 0x7e, 0xe7, 0xc3, 0xc3, 0xe7, 0x7e},
{0x00, 0x00, 0x7e, 0xe7, 0x03, 0x03, 0x03, 0x7f, 0xe7, 0xc3, 0xc3, 0xe7, 0x7e},
{0x00, 0x00, 0x00, 0x38, 0x38, 0x00, 0x00, 0x38, 0x38, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x30, 0x18, 0x1c, 0x1c, 0x00, 0x00, 0x1c, 0x1c, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x06, 0x0c, 0x18, 0x30, 0x60, 0xc0, 0x60, 0x30, 0x18, 0x0c, 0x06},
{0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x03, 0x06, 0x0c, 0x18, 0x30, 0x60},
{0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x18, 0x0c, 0x06, 0x03, 0xc3, 0xc3, 0x7e},
{0x00, 0x00, 0x3f, 0x60, 0xcf, 0xdb, 0xd3, 0xdd, 0xc3, 0x7e, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xc3, 0xc3, 0xc3, 0xc3, 0xff, 0xc3, 0xc3, 0xc3, 0x66, 0x3c, 0x18},
{0x00, 0x00, 0xfe, 0xc7, 0xc3, 0xc3, 0xc7, 0xfe, 0xc7, 0xc3, 0xc3, 0xc7, 0xfe},
{0x00, 0x00, 0x7e, 0xe7, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xe7, 0x7e},
{0x00, 0x00, 0xfc, 0xce, 0xc7, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc7, 0xce, 0xfc},
{0x00, 0x00, 0xff, 0xc0, 0xc0, 0xc0, 0xc0, 0xfc, 0xc0, 0xc0, 0xc0, 0xc0, 0xff},
{0x00, 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xfc, 0xc0, 0xc0, 0xc0, 0xff},
{0x00, 0x00, 0x7e, 0xe7, 0xc3, 0xc3, 0xcf, 0xc0, 0xc0, 0xc0, 0xc0, 0xe7, 0x7e},
{0x00, 0x00, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xff, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3},
{0x00, 0x00, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7e},
{0x00, 0x00, 0x7c, 0xee, 0xc6, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06},
{0x00, 0x00, 0xc3, 0xc6, 0xcc, 0xd8, 0xf0, 0xe0, 0xf0, 0xd8, 0xcc, 0xc6, 0xc3},
{0x00, 0x00, 0xff, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0},
{0x00, 0x00, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xdb, 0xff, 0xff, 0xe7, 0xc3},
{0x00, 0x00, 0xc7, 0xc7, 0xcf, 0xcf, 0xdf, 0xdb, 0xfb, 0xf3, 0xf3, 0xe3, 0xe3},
{0x00, 0x00, 0x7e, 0xe7, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xe7, 0x7e},
{0x00, 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xfe, 0xc7, 0xc3, 0xc3, 0xc7, 0xfe},
{0x00, 0x00, 0x3f, 0x6e, 0xdf, 0xdb, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0x66, 0x3c},
{0x00, 0x00, 0xc3, 0xc6, 0xcc, 0xd8, 0xf0, 0xfe, 0xc7, 0xc3, 0xc3, 0xc7, 0xfe},
{0x00, 0x00, 0x7e, 0xe7, 0x03, 0x03, 0x07, 0x7e, 0xe0, 0xc0, 0xc0, 0xe7, 0x7e},
{0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff},
{0x00, 0x00, 0x7e, 0xe7, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3},
{0x00, 0x00, 0x18, 0x3c, 0x3c, 0x66, 0x66, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3},
{0x00, 0x00, 0xc3, 0xe7, 0xff, 0xff, 0xdb, 0xdb, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3},
{0x00, 0x00, 0xc3, 0x66, 0x66, 0x3c, 0x3c, 0x18, 0x3c, 0x3c, 0x66, 0x66, 0xc3},
{0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x3c, 0x66, 0x66, 0xc3},
{0x00, 0x00, 0xff, 0xc0, 0xc0, 0x60, 0x30, 0x7e, 0x0c, 0x06, 0x03, 0x03, 0xff},
{0x00, 0x00, 0x3c, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3c},
{0x00, 0x03, 0x03, 0x06, 0x06, 0x0c, 0x0c, 0x18, 0x18, 0x30, 0x30, 0x60, 0x60},
{0x00, 0x00, 0x3c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x3c},
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc3, 0x66, 0x3c, 0x18},
{0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x38, 0x30, 0x70},
{0x00, 0x00, 0x7f, 0xc3, 0xc3, 0x7f, 0x03, 0xc3, 0x7e, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xfe, 0xc3, 0xc3, 0xc3, 0xc3, 0xfe, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0},
{0x00, 0x00, 0x7e, 0xc3, 0xc0, 0xc0, 0xc0, 0xc3, 0x7e, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x7f, 0xc3, 0xc3, 0xc3, 0xc3, 0x7f, 0x03, 0x03, 0x03, 0x03, 0x03},
{0x00, 0x00, 0x7f, 0xc0, 0xc0, 0xfe, 0xc3, 0xc3, 0x7e, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 0xfc, 0x30, 0x30, 0x30, 0x33, 0x1e},
{0x7e, 0xc3, 0x03, 0x03, 0x7f, 0xc3, 0xc3, 0xc3, 0x7e, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xfe, 0xc0, 0xc0, 0xc0, 0xc0},
{0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x18, 0x00},
{0x38, 0x6c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x0c, 0x00},
{0x00, 0x00, 0xc6, 0xcc, 0xf8, 0xf0, 0xd8, 0xcc, 0xc6, 0xc0, 0xc0, 0xc0, 0xc0},
{0x00, 0x00, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78},
{0x00, 0x00, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xfe, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xfc, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00},
{0xc0, 0xc0, 0xc0, 0xfe, 0xc3, 0xc3, 0xc3, 0xc3, 0xfe, 0x00, 0x00, 0x00, 0x00},
{0x03, 0x03, 0x03, 0x7f, 0xc3, 0xc3, 0xc3, 0xc3, 0x7f, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xe0, 0xfe, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xfe, 0x03, 0x03, 0x7e, 0xc0, 0xc0, 0x7f, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x1c, 0x36, 0x30, 0x30, 0x30, 0x30, 0xfc, 0x30, 0x30, 0x30, 0x00},
{0x00, 0x00, 0x7e, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x18, 0x3c, 0x3c, 0x66, 0x66, 0xc3, 0xc3, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xc3, 0xe7, 0xff, 0xdb, 0xc3, 0xc3, 0xc3, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xc3, 0x66, 0x3c, 0x18, 0x3c, 0x66, 0xc3, 0x00, 0x00, 0x00, 0x00},
{0xc0, 0x60, 0x60, 0x30, 0x18, 0x3c, 0x66, 0x66, 0xc3, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0xff, 0x60, 0x30, 0x18, 0x0c, 0x06, 0xff, 0x00, 0x00, 0x00, 0x00},
{0x00, 0x00, 0x0f, 0x18, 0x18, 0x18, 0x38, 0xf0, 0x38, 0x18, 0x18, 0x18, 0x0f},
{0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18},
{0x00, 0x00, 0xf0, 0x18, 0x18, 0x18, 0x1c, 0x0f, 0x1c, 0x18, 0x18, 0x18, 0xf0},
{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x8f, 0xf1, 0x60, 0x00, 0x00, 0x00},
{0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff}};

unsigned char colors8[256][3] = {
	{0x00, 0x00, 0x00},
	{0x80, 0x00, 0x00},
	{0x00, 0x80, 0x00},
	{0x80, 0x80, 0x00},
	{0x00, 0x00, 0x80},
	{0x80, 0x00, 0x80},
	{0x00, 0x80, 0x80},
	{0xc0, 0xc0, 0xc0},
	{0x80, 0x80, 0x80},
	{0xff, 0x00, 0x00},
	{0x00, 0xff, 0x00},
	{0xff, 0xff, 0x00},
	{0x00, 0x00, 0xff},
	{0xff, 0x00, 0xff},
	{0x00, 0xff, 0xff},
	{0xff, 0xff, 0xff},
	{0x00, 0x00, 0x00},
	{0x00, 0x00, 0x5f},
	{0x00, 0x00, 0x87},
	{0x00, 0x00, 0xaf},
	{0x00, 0x00, 0xd7},
	{0x00, 0x00, 0xff},
	{0x00, 0x5f, 0x00},
	{0x00, 0x5f, 0x5f},
	{0x00, 0x5f, 0x87},
	{0x00, 0x5f, 0xaf},
	{0x00, 0x5f, 0xd7},
	{0x00, 0x5f, 0xff},
	{0x00, 0x87, 0x00},
	{0x00, 0x87, 0x5f},
	{0x00, 0x87, 0x87},
	{0x00, 0x87, 0xaf},
	{0x00, 0x87, 0xd7},
	{0x00, 0x87, 0xff},
	{0x00, 0xaf, 0x00},
	{0x00, 0xaf, 0x5f},
	{0x00, 0xaf, 0x87},
	{0x00, 0xaf, 0xaf},
	{0x00, 0xaf, 0xd7},
	{0x00, 0xaf, 0xff},
	{0x00, 0xd7, 0x00},
	{0x00, 0xd7, 0x5f},
	{0x00, 0xd7, 0x87},
	{0x00, 0xd7, 0xaf},
	{0x00, 0xd7, 0xd7},
	{0x00, 0xd7, 0xff},
	{0x00, 0xff, 0x00},
	{0x00, 0xff, 0x5f},
	{0x00, 0xff, 0x87},
	{0x00, 0xff, 0xaf},
	{0x00, 0xff, 0xd7},
	{0x00, 0xff, 0xff},
	{0x5f, 0x00, 0x00},
	{0x5f, 0x00, 0x5f},
	{0x5f, 0x00, 0x87},
	{0x5f, 0x00, 0xaf},
	{0x5f, 0x00, 0xd7},
	{0x5f, 0x00, 0xff},
	{0x5f, 0x5f, 0x00},
	{0x5f, 0x5f, 0x5f},
	{0x5f, 0x5f, 0x87},
	{0x5f, 0x5f, 0xaf},
	{0x5f, 0x5f, 0xd7},
	{0x5f, 0x5f, 0xff},
	{0x5f, 0x87, 0x00},
	{0x5f, 0x87, 0x5f},
	{0x5f, 0x87, 0x87},
	{0x5f, 0x87, 0xaf},
	{0x5f, 0x87, 0xd7},
	{0x5f, 0x87, 0xff},
	{0x5f, 0xaf, 0x00},
	{0x5f, 0xaf, 0x5f},
	{0x5f, 0xaf, 0x87},
	{0x5f, 0xaf, 0xaf},
	{0x5f, 0xaf, 0xd7},
	{0x5f, 0xaf, 0xff},
	{0x5f, 0xd7, 0x00},
	{0x5f, 0xd7, 0x5f},
	{0x5f, 0xd7, 0x87},
	{0x5f, 0xd7, 0xaf},
	{0x5f, 0xd7, 0xd7},
	{0x5f, 0xd7, 0xff},
	{0x5f, 0xff, 0x00},
	{0x5f, 0xff, 0x5f},
	{0x5f, 0xff, 0x87},
	{0x5f, 0xff, 0xaf},
	{0x5f, 0xff, 0xd7},
	{0x5f, 0xff, 0xff},
	{0x87, 0x00, 0x00},
	{0x87, 0x00, 0x5f},
	{0x87, 0x00, 0x87},
	{0x87, 0x00, 0xaf},
	{0x87, 0x00, 0xd7},
	{0x87, 0x00, 0xff},
	{0x87, 0x5f, 0x00},
	{0x87, 0x5f, 0x5f},
	{0x87, 0x5f, 0x87},
	{0x87, 0x5f, 0xaf},
	{0x87, 0x5f, 0xd7},
	{0x87, 0x5f, 0xff},
	{0x87, 0x87, 0x00},
	{0x87, 0x87, 0x5f},
	{0x87, 0x87, 0x87},
	{0x87, 0x87, 0xaf},
	{0x87, 0x87, 0xd7},
	{0x87, 0x87, 0xff},
	{0x87, 0xaf, 0x00},
	{0x87, 0xaf, 0x5f},
	{0x87, 0xaf, 0x87},
	{0x87, 0xaf, 0xaf},
	{0x87, 0xaf, 0xd7},
	{0x87, 0xaf, 0xff},
	{0x87, 0xd7, 0x00},
	{0x87, 0xd7, 0x5f},
	{0x87, 0xd7, 0x87},
	{0x87, 0xd7, 0xaf},
	{0x87, 0xd7, 0xd7},
	{0x87, 0xd7, 0xff},
	{0x87, 0xff, 0x00},
	{0x87, 0xff, 0x5f},
	{0x87, 0xff, 0x87},
	{0x87, 0xff, 0xaf},
	{0x87, 0xff, 0xd7},
	{0x87, 0xff, 0xff},
	{0xaf, 0x00, 0x00},
	{0xaf, 0x00, 0x5f},
	{0xaf, 0x00, 0x87},
	{0xaf, 0x00, 0xaf},
	{0xaf, 0x00, 0xd7},
	{0xaf, 0x00, 0xff},
	{0xaf, 0x5f, 0x00},
	{0xaf, 0x5f, 0x5f},
	{0xaf, 0x5f, 0x87},
	{0xaf, 0x5f, 0xaf},
	{0xaf, 0x5f, 0xd7},
	{0xaf, 0x5f, 0xff},
	{0xaf, 0x87, 0x00},
	{0xaf, 0x87, 0x5f},
	{0xaf, 0x87, 0x87},
	{0xaf, 0x87, 0xaf},
	{0xaf, 0x87, 0xd7},
	{0xaf, 0x87, 0xff},
	{0xaf, 0xaf, 0x00},
	{0xaf, 0xaf, 0x5f},
	{0xaf, 0xaf, 0x87},
	{0xaf, 0xaf, 0xaf},
	{0xaf, 0xaf, 0xd7},
	{0xaf, 0xaf, 0xff},
	{0xaf, 0xd7, 0x00},
	{0xaf, 0xd7, 0x5f},
	{0xaf, 0xd7, 0x87},
	{0xaf, 0xd7, 0xaf},
	{0xaf, 0xd7, 0xd7},
	{0xaf, 0xd7, 0xff},
	{0xaf, 0xff, 0x00},
	{0xaf, 0xff, 0x5f},
	{0xaf, 0xff, 0x87},
	{0xaf, 0xff, 0xaf},
	{0xaf, 0xff, 0xd7},
	{0xaf, 0xff, 0xff},
	{0xd7, 0x00, 0x00},
	{0xd7, 0x00, 0x5f},
	{0xd7, 0x00, 0x87},
	{0xd7, 0x00, 0xaf},
	{0xd7, 0x00, 0xd7},
	{0xd7, 0x00, 0xff},
	{0xd7, 0x5f, 0x00},
	{0xd7, 0x5f, 0x5f},
	{0xd7, 0x5f, 0x87},
	{0xd7, 0x5f, 0xaf},
	{0xd7, 0x5f, 0xd7},
	{0xd7, 0x5f, 0xff},
	{0xd7, 0x87, 0x00},
	{0xd7, 0x87, 0x5f},
	{0xd7, 0x87, 0x87},
	{0xd7, 0x87, 0xaf},
	{0xd7, 0x87, 0xd7},
	{0xd7, 0x87, 0xff},
	{0xd7, 0xaf, 0x00},
	{0xd7, 0xaf, 0x5f},
	{0xd7, 0xaf, 0x87},
	{0xd7, 0xaf, 0xaf},
	{0xd7, 0xaf, 0xd7},
	{0xd7, 0xaf, 0xff},
	{0xd7, 0xd7, 0x00},
	{0xd7, 0xd7, 0x5f},
	{0xd7, 0xd7, 0x87},
	{0xd7, 0xd7, 0xaf},
	{0xd7, 0xd7, 0xd7},
	{0xd7, 0xd7, 0xff},
	{0xd7, 0xff, 0x00},
	{0xd7, 0xff, 0x5f},
	{0xd7, 0xff, 0x87},
	{0xd7, 0xff, 0xaf},
	{0xd7, 0xff, 0xd7},
	{0xd7, 0xff, 0xff},
	{0xff, 0x00, 0x00},
	{0xff, 0x00, 0x5f},
	{0xff, 0x00, 0x87},
	{0xff, 0x00, 0xaf},
	{0xff, 0x00, 0xd7},
	{0xff, 0x00, 0xff},
	{0xff, 0x5f, 0x00},
	{0xff, 0x5f, 0x5f},
	{0xff, 0x5f, 0x87},
	{0xff, 0x5f, 0xaf},
	{0xff, 0x5f, 0xd7},
	{0xff, 0x5f, 0xff},
	{0xff, 0x87, 0x00},
	{0xff, 0x87, 0x5f},
	{0xff, 0x87, 0x87},
	{0xff, 0x87, 0xaf},
	{0xff, 0x87, 0xd7},
	{0xff, 0x87, 0xff},
	{0xff, 0xaf, 0x00},
	{0xff, 0xaf, 0x5f},
	{0xff, 0xaf, 0x87},
	{0xff, 0xaf, 0xaf},
	{0xff, 0xaf, 0xd7},
	{0xff, 0xaf, 0xff},
	{0xff, 0xd7, 0x00},
	{0xff, 0xd7, 0x5f},
	{0xff, 0xd7, 0x87},
	{0xff, 0xd7, 0xaf},
	{0xff, 0xd7, 0xd7},
	{0xff, 0xd7, 0xff},
	{0xff, 0xff, 0x00},
	{0xff, 0xff, 0x5f},
	{0xff, 0xff, 0x87},
	{0xff, 0xff, 0xaf},
	{0xff, 0xff, 0xd7},
	{0xff, 0xff, 0xff},
	{0x08, 0x08, 0x08},
	{0x12, 0x12, 0x12},
	{0x1c, 0x1c, 0x1c},
	{0x26, 0x26, 0x26},
	{0x30, 0x30, 0x30},
	{0x3a, 0x3a, 0x3a},
	{0x44, 0x44, 0x44},
	{0x4e, 0x4e, 0x4e},
	{0x58, 0x58, 0x58},
	{0x62, 0x62, 0x62},
	{0x6c, 0x6c, 0x6c},
	{0x76, 0x76, 0x76},
	{0x80, 0x80, 0x80},
	{0x8a, 0x8a, 0x8a},
	{0x94, 0x94, 0x94},
	{0x9e, 0x9e, 0x9e},
	{0xa8, 0xa8, 0xa8},
	{0xb2, 0xb2, 0xb2},
	{0xbc, 0xbc, 0xbc},
	{0xc6, 0xc6, 0xc6},
	{0xd0, 0xd0, 0xd0},
	{0xda, 0xda, 0xda},
	{0xe4, 0xe4, 0xe4},
	{0xee, 0xee, 0xee}
};

bool color_compare(color a, color b){
	if(a.red > b.red){
		return true;
	} else if(a.red < b.red){
		return false;
	} else if(a.green > b.green){
		return true;
	} else if(a.green < b.green){
		return true;
	} else if(a.blue > b.blue){
		return true;
	} else {
		return false;
	}
}

double get_variance(variance *v){
	return v->m/v->num_elements;
}

void add_value(variance *v, double value){
	double new_mean;
	new_mean = ((double) v->num_elements)/(v->num_elements + 1)*v->mean + value/(v->num_elements + 1);
	v->m += (value - v->mean)*(value - new_mean);
	v->mean = new_mean;
	v->num_elements++;
}

void subtract_value(variance *v, double value){
	double new_mean;
	new_mean = (v->mean*v->num_elements - value)/(v->num_elements - 1);
	v->m -= (value - new_mean)*(value - v->mean);
	v->mean = new_mean;
	v->num_elements--;
}

screen *create_screen(unsigned int size_x, unsigned int size_y){
	screen *output;
	unsigned int i;
	unsigned int j;
	output = malloc(sizeof(screen));
	output->size_x = size_x;
	output->size_y = size_y;
	output->data = calloc(size_x*8, sizeof(color *));
	for(i = 0; i < size_x*8; i++){
		output->data[i] = calloc(size_y*13, sizeof(color));
	}
	output->chars = calloc(size_x, sizeof(char *));
	for(i = 0; i < size_x; i++){
		output->chars[i] = calloc(size_y, sizeof(char));
	}
	output->foreground_colors = calloc(size_x, sizeof(color *));
	for(i = 0; i < size_x; i++){
		output->foreground_colors[i] = calloc(size_y, sizeof(color));
	}
	output->background_colors = calloc(size_x, sizeof(color *));
	for(i = 0; i < size_x; i++){
		output->background_colors[i] = calloc(size_y, sizeof(color));
	}
	output->best_variance = calloc(size_x, sizeof(double *));
	for(i = 0; i < size_x; i++){
		output->best_variance[i] = calloc(size_y, sizeof(double));
	}
	for(i = 0; i < 96; i++){
		output->foreground_red[i] = calloc(size_x, sizeof(variance *));
		for(j = 0; j < size_x; j++){
			output->foreground_red[i][j] = calloc(size_y, sizeof(variance));
		}
		output->foreground_green[i] = calloc(size_x, sizeof(variance *));
		for(j = 0; j < size_x; j++){
			output->foreground_green[i][j] = calloc(size_y, sizeof(variance));
		}
		output->foreground_blue[i] = calloc(size_x, sizeof(variance *));
		for(j = 0; j < size_x; j++){
			output->foreground_blue[i][j] = calloc(size_y, sizeof(variance));
		}
		output->background_red[i] = calloc(size_x, sizeof(variance *));
		for(j = 0; j < size_x; j++){
			output->background_red[i][j] = calloc(size_y, sizeof(variance));
		}
		output->background_green[i] = calloc(size_x, sizeof(variance *));
		for(j = 0; j < size_x; j++){
			output->background_green[i][j] = calloc(size_y, sizeof(variance));
		}
		output->background_blue[i] = calloc(size_x, sizeof(variance *));
		for(j = 0; j < size_x; j++){
			output->background_blue[i][j] = calloc(size_y, sizeof(variance));
		}
	}
	output->print_str = calloc(size_x*size_y*23 + size_y + 1, sizeof(char));
	for(i = 0; i < size_y; i++){
		output->print_str[(output->size_x*23 + 1)*i + output->size_x*23] = '\n';
	}
	for(i = 0; i < size_x; i++){
		for(j = 0; j < size_y; j++){
			output->print_str[(output->size_x*23 + 1)*j + i*23] = '\e';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 1] = '[';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 2] = '3';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 3] = '8';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 4] = ';';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 5] = '5';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 6] = ';';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 7] = '0';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 8] = '0';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 9] = '0';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 10] = 'm';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 11] = '\e';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 12] = '[';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 13] = '4';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 14] = '8';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 15] = ';';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 16] = '5';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 17] = ';';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 18] = '0';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 19] = '0';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 20] = '0';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 21] = 'm';
			output->print_str[(output->size_x*23 + 1)*j + i*23 + 22] = ' ';
		}
	}
	output->print_str[size_x*size_y*23 + size_y] = (char) 0;
	recalculate_all(output);
	return output;
}

void recalculate_all(screen *s){
	unsigned int char_x;
	unsigned int char_y;
	unsigned int inner_x;
	unsigned int inner_y;
	unsigned char c;
	bool foreground;
	unsigned int x;
	unsigned int y;
	for(char_x = 0; char_x < s->size_x; char_x++){
		for(char_y = 0; char_y < s->size_y; char_y++){
			for(c = 0; c < 95; c++){
				s->foreground_red[c][char_x][char_y].num_elements = 0;
				s->foreground_green[c][char_x][char_y].num_elements = 0;
				s->foreground_blue[c][char_x][char_y].num_elements = 0;
				s->background_red[c][char_x][char_y].num_elements = 0;
				s->background_green[c][char_x][char_y].num_elements = 0;
				s->background_blue[c][char_x][char_y].num_elements = 0;
				for(inner_x = 0; inner_x < 8; inner_x++){
					for(inner_y = 0; inner_y < 13; inner_y++){
						x = char_x*8 + inner_x;
						y = char_y*13 + inner_y;
						if((0b10000000>>inner_x)&ascii_chars[c][12 - inner_y]){
							foreground = true;
						} else {
							foreground = false;
						}
						if(foreground){
							add_value(s->foreground_red[c][char_x] + char_y, s->data[x][y].red);
							add_value(s->foreground_green[c][char_x] + char_y, s->data[x][y].green);
							add_value(s->foreground_blue[c][char_x] + char_y, s->data[x][y].blue);
						} else {
							add_value(s->background_red[c][char_x] + char_y, s->data[x][y].red);
							add_value(s->background_green[c][char_x] + char_y, s->data[x][y].green);
							add_value(s->background_blue[c][char_x] + char_y, s->data[x][y].blue);
						}
					}
				}
			}
		}
	}
}

void set_char(screen *s, unsigned int x, unsigned int y, char c, unsigned char foreground, unsigned char background){
	unsigned char ones_digit;
	unsigned char tens_digit;
	unsigned char hundreds_digit;
	char digits[10] = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9'};
	
	ones_digit = foreground%10;
	foreground -= ones_digit;
	tens_digit = (foreground%100)/10;
	foreground -= tens_digit;
	hundreds_digit = foreground/100;
	
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 7] = digits[hundreds_digit];
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 8] = digits[tens_digit];
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 9] = digits[ones_digit];

	ones_digit = background%10;
	background -= ones_digit;
	tens_digit = (background%100)/10;
	background -= tens_digit;
	hundreds_digit = background/100;
	
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 18] = digits[hundreds_digit];
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 19] = digits[tens_digit];
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 20] = digits[ones_digit];
	
	s->print_str[(s->size_x*23 + 1)*y + x*23 + 22] = c;
}

unsigned char match_color(color c){
	int var;
	int best_var;
	unsigned int best;
	unsigned int i;
	best = 0;
	best_var = -1;
	for(i = 0; i <= 255; i++){
		var = (c.red - colors8[i][0])*(c.red - colors8[i][0]) + (c.green - colors8[i][1])*(c.green - colors8[i][1]) + (c.blue - colors8[i][2])*(c.blue - colors8[i][2]);
		if(var < best_var || best_var < 0){
			best_var = var;
			best = i;
		}
	}
	return best;
}


void set_pixel(screen *s, unsigned int x, unsigned int y, color c){
	unsigned int char_x;
	unsigned int char_y;
	unsigned char inner_x;
	unsigned char inner_y;
	bool foreground;
	unsigned char i;
	double total_variance;
	
	char_x = x/8;
	char_y = y/13;
	inner_x = x%8;
	inner_y = y%13;
	for(i = 0; i < 95; i++){
		if((0b10000000>>inner_x)&ascii_chars[i][12 - inner_y]){
			foreground = true;
		} else {
			foreground = false;
		}
		if(foreground){
			subtract_value(s->foreground_red[i][char_x] + char_y, s->data[x][y].red);
			subtract_value(s->foreground_green[i][char_x] + char_y, s->data[x][y].green);
			subtract_value(s->foreground_blue[i][char_x] + char_y, s->data[x][y].blue);
			add_value(s->foreground_red[i][char_x] + char_y, c.red);
			add_value(s->foreground_green[i][char_x] + char_y, c.green);
			add_value(s->foreground_blue[i][char_x] + char_y, c.blue);
		} else {
			subtract_value(s->background_red[i][char_x] + char_y, s->data[x][y].red);
			subtract_value(s->background_green[i][char_x] + char_y, s->data[x][y].green);
			subtract_value(s->background_blue[i][char_x] + char_y, s->data[x][y].blue);
			add_value(s->background_red[i][char_x] + char_y, c.red);
			add_value(s->background_green[i][char_x] + char_y, c.green);
			add_value(s->background_blue[i][char_x] + char_y, c.blue);
		}
		total_variance = get_variance(s->foreground_red[i][char_x] + char_y) + get_variance(s->foreground_green[i][char_x] + char_y) + get_variance(s->foreground_blue[i][char_x] + char_y) + get_variance(s->background_red[i][char_x] + char_y) + get_variance(s->background_green[i][char_x] + char_y) + get_variance(s->background_blue[i][char_x] + char_y);
		if(total_variance < s->best_variance[char_x][char_y]){
			s->foreground_colors[char_x][char_y] = (color) {.red = s->foreground_red[i][char_x][char_y].mean, .green = s->foreground_green[i][char_x][char_y].mean, .blue = s->foreground_blue[i][char_x][char_y].mean};
			s->background_colors[char_x][char_y] = (color) {.red = s->background_red[i][char_x][char_y].mean, .green = s->background_green[i][char_x][char_y].mean, .blue = s->background_blue[i][char_x][char_y].mean};

			s->best_variance[char_x][char_y] = total_variance;
			if(i == 95){
				s->chars[char_x][char_y] = (char) 219;
				set_char(s, char_x, char_y, (char) 219, match_color(s->foreground_colors[char_x][char_y]), match_color(s->background_colors[char_x][char_y]));
			} else {
				s->chars[char_x][char_y] = i + 32;
				set_char(s, char_x, char_y, i + 32, match_color(s->foreground_colors[char_x][char_y]), match_color(s->background_colors[char_x][char_y]));
			}
		}
	}
	s->data[x][y] = c;
}

void rect(screen *s, unsigned int x1, unsigned int y1, unsigned int x2, unsigned int y2, color c){
	unsigned int x;
	unsigned int y;
	for(x = x1; x <= x2; x++){
		for(y = y1; y <= y2; y++){
			set_pixel(s, x, y, c);
		}
	}
}

void display(screen *s){
	printf("\033[0;0H%s", s->print_str);
}
